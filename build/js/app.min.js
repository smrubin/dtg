function FreeSegment(e,t){this.type="FreeSegment",this.a=e,this.b=t,this.noon={a:e,b:t},this.three={a:{x:-e.y,y:e.x},b:{x:-t.y,y:t.x}},this.six={a:{x:-e.x,y:-e.y},b:{x:-t.x,y:-t.y}},this.nine={a:{x:e.y,y:-e.x},b:{x:t.y,y:-t.x}}}function FixedSegment(e,t){this.type="FixedSegment",this.a=e,this.b=t,this.noon={a:e,b:t},this.three={a:e,b:t},this.six={a:e,b:t},this.nine={a:e,b:t}}function PivotSegment(e,t){this.type="FreeSegment",this.a=e,this.b=t;var n=t.x-e.x,i=t.y-e.y;this.delta={x:n,y:i},this.noon={a:e,b:t},this.three={a:{x:-e.y,y:e.x},b:{x:-e.y+n,y:e.x+i}},this.six={a:{x:-e.x,y:-e.y},b:{x:-e.x+n,y:-e.y+i}},this.nine={a:{x:e.y,y:-e.x},b:{x:e.y+n,y:-e.x+i}}}function RotateSegment(e,t){this.type="RotateSegment",this.a=e,this.b=t;var n=t.x-e.x,i=t.y-e.y;this.delta={x:n,y:i},this.theta=Math.atan2(i,n),this.noon={a:e,b:t},this.three={a:e,b:this.getB(TAU/4)},this.six={a:e,b:this.getB(TAU/2)},this.nine={a:e,b:this.getB(3*TAU/4)}}function FlyWheel(e){this.angle=0,this.friction=.95,this.velocity=0;for(var t in e)this[t]=e[t]}function Maze(){this.freeSegments=[],this.fixedSegments=[],this.pivotSegments=[],this.rotateSegments=[],this.flyWheel=new FlyWheel({friction:.8}),this.connections={}}function getFrontMatter(e){if(e){var t={};return e.split("\n").forEach(function(e){if(e){var n=e.split(":"),i=n[0].trim(),o=n[1].trim();"true"===o?o=!0:"false"===o?o=!1:o.match(/$\d+(\.\d+)?^/)?o=parseFloat(o,10):o.match(/$\d+\.\d+^/)&&(o=parseFloat(o)),t[i]=o}}),t}}function getHorizSegment(e,t,n){var i={x:e+1,y:t},o={x:e-1,y:t};return new n(i,o)}function getVertSegment(e,t,n){var i={x:e,y:t+1},o={x:e,y:t-1};return new n(i,o)}function fillCircle(e,t,n,i){e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.fill(),e.closePath()}function strokeCircle(e,t,n,i){e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.stroke(),e.closePath()}function renderGoal(e,t,n,i,o,r){e.save(),e.translate(t,n),e.rotate(-i);var a=Math.PI/2,s=r,c=Math.cos(a)*s-25,l=Math.sin(a)*s-40;e.drawImage(dumpImg,c,l),e.restore()}function WinAnimation(e,t){this.x=e,this.y=t,this.startTime=new Date,this.isPlaying=!0}function renderStar(e){e.lineWidth=8,e.lineJoin="round",e.lineCap="round",e.fillStyle="hsla(50, 100%, 50%, 1)",e.strokeStyle="hsla(50, 100%, 50%, 1)",e.beginPath();for(var t=0;11>t;t++){var n=2*Math.PI*t/10+Math.PI/2,i=t%2?20:10,o=Math.cos(n)*i,r=Math.sin(n)*i;e[t?"lineTo":"moveTo"](o,r)}e.fill(),e.stroke(),e.closePath()}function getParent(e,t){for(var n=e;n!=document.body;){if(n.matches(t))return n;n=n.parentNode}}function loadLevel(e){var t=levelsElem.querySelector("#"+e);if(maze=new Maze,maze.id=e,!t)return void console.error("pre not found for "+e);maze.loadText(t.textContent),levelList.classList.remove("is-open"),nextLevelButton.classList.remove("is-open"),window.scrollTo(0,0);var n=levelList.querySelector(".is-playing");n&&n.classList.remove("is-playing"),levelList.querySelector('[data-id="'+e+'"]').classList.add("is-playing"),localStorage.setItem("currentLevel",e)}function getIsInsideCub(e){var t=getCanvasMazePosition(e),n=Math.abs(t.x-cub[maze.orientation].x*gridSize),i=Math.abs(t.y-cub[maze.orientation].y*gridSize),o=1.5*gridSize;return o>=n&&o>=i}function getCanvasMazePosition(e){var t=e.pageX-canvasLeft,n=e.pageY-canvasTop;return{x:t-mazeCenter.x,y:n-mazeCenter.y}}function getDragAngle(e){var t=getCanvasMazePosition(e);return normalizeAngle(Math.atan2(t.y,t.x))}function animate(){update(),render(),requestAnimationFrame(animate)}function update(){dragCub(),dragAngle?maze.flyWheel.setAngle(dragAngle):maze.attractAlignFlyWheel(),maze.update(),winAnim&&winAnim.update()}function dragCub(){if(cubDragMove){var e=getCubConnections(),t={x:dragStartPegPosition.x+cubDragMove.x,y:dragStartPegPosition.y+cubDragMove.y},n=getDragPeg(e,t);cub.setPeg(n,maze.orientation);var i=getDragPosition(e,t),o=getCubPosition(),r={x:i.x-o.x,y:i.y-o.y};cub.setOffset(r,maze.orientation)}}function getCubPosition(){return{x:cub[maze.orientation].x*gridSize+mazeCenter.x,y:cub[maze.orientation].y*gridSize+mazeCenter.y}}function getCubConnections(){var e=cub[maze.orientation].x,t=cub[maze.orientation].y,n=maze.orientation+":"+e+","+t;return maze.connections[n]}function getDragPosition(e,t){if(1==e.length)return getSegmentDragPosition(e[0],t);var n=e.map(function(e){var n=getSegmentDragPosition(e,t);return{position:n,distance:getDistance(t,n)}});return n.sort(distanceSorter),n[0].position}function getSegmentDragPosition(e,t){var n,i,o=e[maze.orientation],r=o.a.y==o.b.y;return r?(n=getSegmentDragCoord(o,"x",t),i=o.a.y*gridSize+mazeCenter.y):(n=o.a.x*gridSize+mazeCenter.x,i=getSegmentDragCoord(o,"y",t)),{x:n,y:i}}function getSegmentDragCoord(e,t,n){var i=e.a[t],o=e.b[t],r=o>i?i:o,a=i>o?i:o;return r=r*gridSize+mazeCenter[t],a=a*gridSize+mazeCenter[t],Math.max(r,Math.min(a,n[t]))}function distanceSorter(e,t){return e.distance-t.distance}function getDragPeg(e,t){var n=[];e.forEach(function(e){var t=e[maze.orientation];addPegPoint(t.a,n),addPegPoint(t.b,n)});var i=n.map(function(e){var n=e.split(","),i={x:parseInt(n[0],10),y:parseInt(n[1],10)},o={x:i.x*gridSize+mazeCenter.x,y:i.y*gridSize+mazeCenter.y};return{peg:i,distance:getDistance(t,o)}});return i.sort(distanceSorter),i[0].peg}function getDistance(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function addPegPoint(e,t){var n=e.x+","+e.y;-1==t.indexOf(n)&&t.push(n)}function onHoverMousemove(e){var t=getIsInsideCub(e);if(t!=isCubHovered){isCubHovered=t;var n=t?"add":"remove";docElem.classList[n]("is-cub-hovered")}}function render(){ctx.clearRect(0,0,canvasWidth,canvasHeight),ctx.save(),ctx.scale(2,2),renderRotateHandle(),maze.render(ctx,mazeCenter,gridSize,maze.flyWheel.angle),winAnim&&winAnim.render(ctx);var e=isCubHovered||isCubDragging;cub.render(ctx,mazeCenter,gridSize,maze.flyWheel.angle,e,img),ctx.restore()}function renderRotateHandle(){if(rotatePointer){ctx.lineCap="round",ctx.lineJoin="round",ctx.lineWidth=.5*gridSize;var e="#EEE";ctx.strokeStyle=e,ctx.fillStyle=e,ctx.beginPath();var t=maze.gridMax*gridSize;ctx.moveTo(mazeCenter.x,mazeCenter.y);var n=normalizeAngle(normalizeAngle(moveAngle)-normalizeAngle(dragStartAngle))>TAU/2;ctx.arc(mazeCenter.x,mazeCenter.y,t,dragStartAngle,moveAngle,n),ctx.lineTo(mazeCenter.x,mazeCenter.y),ctx.stroke(),ctx.fill(),ctx.closePath()}}function completeLevel(){var e=getCubPosition();winAnim=new WinAnimation(e.x,e.y),levelList.querySelector('[data-id="'+maze.id+'"]').classList.add("did-complete"),-1==completedLevels.indexOf(maze.id)&&(completedLevels.push(maze.id),localStorage.setItem("completedLevels",completedLevels.join(","))),getNextLevel()&&setTimeout(function(){nextLevelButton.classList.add("is-open")},1e3)}function getNextLevel(){var e=levels.indexOf(maze.id);return levels[e+1]}function normalizeAngle(e){return(e%TAU+TAU)%TAU}!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}(this,function(){"use strict";function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var n=this._events=this._events||{},i=n[e]=n[e]||[];return-1==i.indexOf(t)&&i.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var n=this._onceEvents=this._onceEvents||{},i=n[e]=n[e]||{};return i[t]=!0,this}},t.off=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=n.indexOf(t);return-1!=i&&n.splice(i,1),this}},t.emitEvent=function(e,t){var n=this._events&&this._events[e];if(n&&n.length){var i=0,o=n[i];t=t||[];for(var r=this._onceEvents&&this._onceEvents[e];o;){var a=r&&r[o];a&&(this.off(e,o),delete r[o]),o.apply(this,t),i+=a?0:1,o=n[i]}return this}},e}),function(e,t){"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(n){return t(e,n)}):"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.Unipointer=t(e,e.EvEmitter)}(window,function(e,t){"use strict";function n(){}function i(){}var o=i.prototype=Object.create(t.prototype);o.bindStartEvent=function(e){this._bindStartEvent(e,!0)},o.unbindStartEvent=function(e){this._bindStartEvent(e,!1)},o._bindStartEvent=function(t,n){n=void 0===n?!0:!!n;var i=n?"addEventListener":"removeEventListener";e.navigator.pointerEnabled?t[i]("pointerdown",this):e.navigator.msPointerEnabled?t[i]("MSPointerDown",this):(t[i]("mousedown",this),t[i]("touchstart",this))},o.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},o.getTouch=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.identifier==this.pointerIdentifier)return n}},o.onmousedown=function(e){var t=e.button;t&&0!==t&&1!==t||this._pointerDown(e,e)},o.ontouchstart=function(e){this._pointerDown(e,e.changedTouches[0])},o.onMSPointerDown=o.onpointerdown=function(e){this._pointerDown(e,e)},o._pointerDown=function(e,t){this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,this.pointerDown(e,t))},o.pointerDown=function(e,t){this._bindPostStartEvents(e),this.emitEvent("pointerDown",[e,t])};var r={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"],MSPointerDown:["MSPointerMove","MSPointerUp","MSPointerCancel"]};return o._bindPostStartEvents=function(t){if(t){var n=r[t.type];n.forEach(function(t){e.addEventListener(t,this)},this),this._boundPointerEvents=n}},o._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){e.removeEventListener(t,this)},this),delete this._boundPointerEvents)},o.onmousemove=function(e){this._pointerMove(e,e)},o.onMSPointerMove=o.onpointermove=function(e){e.pointerId==this.pointerIdentifier&&this._pointerMove(e,e)},o.ontouchmove=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerMove(e,t)},o._pointerMove=function(e,t){this.pointerMove(e,t)},o.pointerMove=function(e,t){this.emitEvent("pointerMove",[e,t])},o.onmouseup=function(e){this._pointerUp(e,e)},o.onMSPointerUp=o.onpointerup=function(e){e.pointerId==this.pointerIdentifier&&this._pointerUp(e,e)},o.ontouchend=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerUp(e,t)},o._pointerUp=function(e,t){this._pointerDone(),this.pointerUp(e,t)},o.pointerUp=function(e,t){this.emitEvent("pointerUp",[e,t])},o._pointerDone=function(){this.isPointerDown=!1,delete this.pointerIdentifier,this._unbindPostStartEvents(),this.pointerDone()},o.pointerDone=n,o.onMSPointerCancel=o.onpointercancel=function(e){e.pointerId==this.pointerIdentifier&&this._pointerCancel(e,e)},o.ontouchcancel=function(e){var t=this.getTouch(e.changedTouches);t&&this._pointerCancel(e,t)},o._pointerCancel=function(e,t){this._pointerDone(),this.pointerCancel(e,t)},o.pointerCancel=function(e,t){this.emitEvent("pointerCancel",[e,t])},i.getPointerPoint=function(e){return{x:e.pageX,y:e.pageY}},i});var proto=FreeSegment.prototype;proto.render=function(e,t,n){var i=this.a.x*n,o=this.a.y*n,r=this.b.x*n,a=this.b.y*n;e.strokeStyle="hsla(204, 70%, 53%, 0.7)",e.lineWidth=.6*n,e.lineCap="round",e.beginPath(),e.moveTo(i,o),e.lineTo(r,a),e.stroke(),e.closePath()};var proto=FixedSegment.prototype;proto.render=function(e,t,n){var i=this.a.x*n,o=this.a.y*n,r=this.b.x*n,a=this.b.y*n;e.strokeStyle="hsla(210, 29%, 24%, 0.6)",e.lineWidth=.8*n,e.lineCap="round",e.beginPath(),e.moveTo(i,o),e.lineTo(r,a),e.stroke(),e.closePath()};var proto=PivotSegment.prototype;proto.render=function(e,t,n,i){var o=this.a.x*n,r=this.a.y*n,a=this.delta.x*n,s=this.delta.y*n;e.save(),e.translate(o,r),e.rotate(-i);var c="hsla(6, 78%, 57%, 0.6)";e.strokeStyle=c,e.lineWidth=.4*n,e.lineCap="round",e.beginPath(),e.moveTo(0,0),e.lineTo(a,s),e.stroke(),e.closePath(),e.fillStyle=c,e.beginPath(),e.arc(0,0,.4*n,0,2*Math.PI),e.fill(),e.closePath(),e.restore()};var TAU=2*Math.PI,proto=RotateSegment.prototype;proto.getB=function(e){return{x:Math.round(this.a.x+2*Math.cos(this.theta+e)),y:Math.round(this.a.y+2*Math.sin(this.theta+e))}},proto.render=function(e,t,n,i){var o=this.a.x*n,r=this.a.y*n;e.save(),e.translate(o,r),e.rotate(i);var a="hsla(150, 100%, 35%, 0.7)";e.strokeStyle=a,e.fillStyle=a,e.lineWidth=.8*n,e.lineJoin="round",e.rotate(TAU/8),e.strokeRect(.2*-n,.2*-n,.4*n,.4*n),e.rotate(-TAU/8),e.lineWidth=.8*n,e.lineCap="round",e.beginPath(),e.moveTo(0,0);var s=this.delta.x*n,c=this.delta.y*n;e.lineTo(s,c),e.stroke(),e.closePath(),e.restore()};var TAU=2*Math.PI,proto=FlyWheel.prototype;proto.integrate=function(){this.velocity*=this.friction,this.angle+=this.velocity,this.normalizeAngle()},proto.applyForce=function(e){this.velocity+=e},proto.normalizeAngle=function(){this.angle=(this.angle%TAU+TAU)%TAU},proto.setAngle=function(e){var t=e-this.angle;t>TAU/2?t-=TAU:-TAU/2>t&&(t+=TAU);var n=t-this.velocity;this.applyForce(n)};var cub={offset:{x:0,y:0}},pegOrienter={noon:function(e){return e},three:function(e){return{x:e.y,y:-e.x}},six:function(e){return{x:-e.x,y:-e.y}},nine:function(e){return{x:-e.y,y:e.x}}};cub.setPeg=function(e,t){e=pegOrienter[t](e),this.peg=e,this.noon={x:e.x,y:e.y},this.three={x:-e.y,y:e.x},this.six={x:-e.x,y:-e.y},this.nine={x:e.y,y:-e.x}};var offsetOrienter={noon:function(e){return e},three:function(e){return{x:e.y,y:-e.x}},six:function(e){return{x:-e.x,y:-e.y}},nine:function(e){return{x:-e.y,y:e.x}}};cub.setOffset=function(e,t){this.offset=offsetOrienter[t](e)},cub.render=function(e,t,n,i,o,r){var a=this.peg.x*n+this.offset.x,s=this.peg.y*n+this.offset.y;e.save(),e.translate(t.x,t.y),e.rotate(i),e.translate(a,s),e.rotate(-i);var c=o?1.15:1;e.scale(c,c),e.drawImage(r,-23,-25),e.restore()};var proto=Maze.prototype;proto.loadText=function(e){var t=e.split("---\n"),n={};t.length>1&&(n=getFrontMatter(t[0]));for(var i=t[t.length-1],o=i.split("\n"),r=this.gridCount=o[0].length,a=this.gridMax=(r-1)/2,s=0;s<o.length;s++)for(var c=o[s],l=c.split(""),u=0;u<l.length;u++){var f=l[u],h=u-a,d=s-a,p="parse"+f;this[p]&&this[p](h,d)}},proto["parse-"]=proto.addFreeHorizSegment=function(e,t){var n=getHorizSegment(e,t,FreeSegment);this.connectSegment(n),this.freeSegments.push(n)},proto["parse|"]=proto.addFreeVertSegment=function(e,t){var n=getVertSegment(e,t,FreeSegment);this.connectSegment(n),this.freeSegments.push(n)},proto["parse="]=proto.addFixedHorizSegment=function(e,t){var n=getHorizSegment(e,t,FixedSegment);this.connectSegment(n),this.fixedSegments.push(n)},proto["parse!"]=proto.addFixedVertSegment=function(e,t){var n=getVertSegment(e,t,FixedSegment);this.connectSegment(n),this.fixedSegments.push(n)},proto["parse^"]=proto.addPivotUpSegment=function(e,t){var n={x:e,y:t+1},i={x:e,y:t-1},o=new PivotSegment(n,i);this.connectSegment(o),this.pivotSegments.push(o)},proto.parsev=proto.addPivotDownSegment=function(e,t){var n={x:e,y:t-1},i={x:e,y:t+1},o=new PivotSegment(n,i);this.connectSegment(o),this.pivotSegments.push(o)},proto["parse<"]=proto.addPivotLeftSegment=function(e,t){var n={x:e+1,y:t},i={x:e-1,y:t},o=new PivotSegment(n,i);this.connectSegment(o),this.pivotSegments.push(o)},proto["parse>"]=proto.addPivotRightSegment=function(e,t){var n={x:e-1,y:t},i={x:e+1,y:t},o=new PivotSegment(n,i);this.connectSegment(o),this.pivotSegments.push(o)},proto.parse8=proto.addRotateUpSegment=function(e,t){var n={x:e,y:t+1},i={x:e,y:t-1},o=new RotateSegment(n,i);this.connectSegment(o),this.rotateSegments.push(o)},proto.parse4=proto.addRotateLeftSegment=function(e,t){var n={x:e+1,y:t},i={x:e-1,y:t},o=new RotateSegment(n,i);this.connectSegment(o),this.rotateSegments.push(o)},proto.parse5=proto.addRotateUpSegment=function(e,t){var n={x:e,y:t-1},i={x:e,y:t+1},o=new RotateSegment(n,i);this.connectSegment(o),this.rotateSegments.push(o)},proto.parse6=proto.addRotateRightSegment=function(e,t){var n={x:e-1,y:t},i={x:e+1,y:t},o=new RotateSegment(n,i);this.connectSegment(o),this.rotateSegments.push(o)},proto["parse#"]=function(e,t){this.addFreeHorizSegment(e,t),this.addFixedHorizSegment(e,t)},proto.parse$=function(e,t){this.addFreeVertSegment(e,t),this.addFixedVertSegment(e,t)},proto.parseI=function(e,t){this.addPivotUpSegment(e,t),this.addFixedVertSegment(e,t)},proto.parseJ=function(e,t){this.addPivotLeftSegment(e,t),this.addFixedHorizSegment(e,t)},proto.parseK=function(e,t){this.addPivotDownSegment(e,t),this.addFixedVertSegment(e,t)},proto.parseL=function(e,t){this.addPivotRightSegment(e,t),this.addFixedHorizSegment(e,t)},proto.parseW=function(e,t){this.addPivotUpSegment(e,t),this.addFreeVertSegment(e,t)},proto.parseA=function(e,t){this.addPivotLeftSegment(e,t),this.addFreeHorizSegment(e,t)},proto.parseS=function(e,t){this.addPivotDownSegment(e,t),this.addFreeVertSegment(e,t)},proto.parseD=function(e,t){this.addPivotRightSegment(e,t),this.addFreeHorizSegment(e,t)},proto["parse@"]=function(e,t){this.startPosition={x:e,y:t},cub.setPeg(this.startPosition,"noon")},proto["parse*"]=function(e,t){this.goalPosition={x:e,y:t}},proto.updateItemGroups=function(){var e={};this.items.forEach(function(t){void 0===e[t.type]&&(e[t.type]=[]),e[t.type].push(t)}),this.itemGroups=e};var orientations=["noon","three","six","nine"];proto.connectSegment=function(e){orientations.forEach(function(t){var n=e[t];this.getIsPegOut(n.a)||this.getIsPegOut(n.b)||(this.connectPeg(e,t,n.a),this.connectPeg(e,t,n.b))},this)},proto.getIsPegOut=function(e){return Math.abs(e.x)>this.gridMax||Math.abs(e.y)>this.gridMax},proto.connectPeg=function(e,t,n){var i=t+":"+n.x+","+n.y,o=this.connections[i];o||(o=this.connections[i]=[]),-1==o.indexOf(e)&&o.push(e)},proto.update=function(){this.flyWheel.integrate();var e=this.flyWheel.angle;TAU/8>e?this.orientation="noon":3*TAU/8>e?this.orientation="three":5*TAU/8>e?this.orientation="six":7*TAU/8>e?this.orientation="nine":this.orientation="noon"},proto.attractAlignFlyWheel=function(){var e,t=this.flyWheel.angle;e=TAU/8>t?0:3*TAU/8>t?TAU/4:5*TAU/8>t?TAU/2:7*TAU/8>t?3*TAU/4:TAU;var n=.03*(e-t);this.flyWheel.applyForce(n)};var TAU=2*Math.PI,orientationAngles={noon:0,three:TAU/4,six:TAU/2,nine:3*TAU/4};proto.render=function(e,t,n,i){var o=orientationAngles[i],r=this.gridMax;i=void 0!==o?o:i||0,e.save(),e.translate(t.x,t.y),this.fixedSegments.forEach(function(i){i.render(e,t,n)}),this.rotateSegments.forEach(function(o){o.render(e,t,n,i)}),e.rotate(i),e.lineWidth=.2*n,e.lineCap="round",e.lineJoin="round",e.lineWidth=.2*n,e.strokeStyle="hsla(0, 0%, 50%, 0.2)",e.save(),e.rotate(Math.PI/4),e.strokeRect(-n/5,-n/5,2*n/5,2*n/5),e.restore(),e.strokeStyle="hsla(330, 100%, 50%, 0.3)",e.lineWidth=.15*n;var a=this.startPosition.x*n,s=this.startPosition.y*n;strokeCircle(e,a,s,.5*n);for(var c=-r;r>=c;c+=2)for(var l=-r;r>=l;l+=2){var u=l*n,f=c*n;e.fillStyle="hsla(0, 0%, 50%, 0.6)",fillCircle(e,u,f,.15*n)}this.freeSegments.forEach(function(i){i.render(e,t,n)}),this.pivotSegments.forEach(function(o){o.render(e,t,n,i)});var h=this.goalPosition.x*n,d=this.goalPosition.y*n;e.lineWidth=.3*n,e.fillStyle="hsla(50, 100%, 50%, 1)",e.strokeStyle="hsla(50, 100%, 50%, 1)",renderGoal(e,h,d,i,.6*n,.3*n),e.restore()};var duration=1500,proto=WinAnimation.prototype;proto.update=function(){this.isPlaying&&(this.t=(new Date-this.startTime)/duration,this.isPlaying=this.t<=1)},proto.render=function(e){this.isPlaying&&(e.save(),e.translate(this.x,this.y),this.renderBurst(e),e.save(),e.scale(.5,-.5),this.renderBurst(e),e.restore(),e.restore())},proto.renderBurst=function(e){for(var t=this.t,n=1-t,i=1-n*n*n*n*n*n*n*n,o=-100*i,r=(2-2*this.t,1.5*(1-t*t*t)),a=1*Math.PI*t*t*t,s=0;5>s;s++)e.save(),e.rotate(2*Math.PI/5*s),e.translate(0,o),e.scale(r,r),e.rotate(a),e.drawImage(hatLargeImg,0,0),e.restore()};var docElem=document.documentElement,canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),img=new Image;img.src="./img/trump-cartoon.png";var hatLargeImg=new Image;hatLargeImg.src="./img/trump-hat-l.png";var hatSmallImg=new Image;hatSmallImg.src="./img/trump-hat-s.png";var dumpImg=new Image;dumpImg.src="./img/dump.png";var canvasSize=Math.min(window.innerWidth,window.innerHeight),canvasWidth=canvas.width=2*window.innerWidth,canvasHeight=canvas.height=2*window.innerHeight-2*canvas.offsetTop,maze,PI=Math.PI,TAU=2*PI,dragAngle=null,cubDragMove=null,isCubHovered=!1,isCubDragging=!1,winAnim,unipointer=new Unipointer,gridSize=Math.min(40,canvasSize/12),mazeCenter={x:canvasWidth/4,y:Math.min(8*gridSize,canvasHeight/4)},instructionsList=document.querySelector(".instructions-list");instructionsList.addEventListener("click",function(e){e.stopPropagation()});var levelList=document.querySelector(".level-list"),levelsElem=document.querySelector(".levels"),levels=[];!function(){for(var e=levelsElem.querySelectorAll("pre"),t=document.createDocumentFragment(),n=0;n<e.length;n++){var i=e[n],o=document.createElement("li");o.className="level-list__item";var r=i.id;o.innerHTML='<span class="level-list__item__number">'+(n+1)+'</span> <span class="level-list__item__blurb">'+i.getAttribute("data-blurb")+'</span><span class="level-list__item__check">✔</span>',o.setAttribute("data-id",r),t.appendChild(o),levels.push(r)}levelList.appendChild(t),levelList.addEventListener("click",function(e){e.stopPropagation()});var a=document.createElement("span");a.className="close-button",levelList.appendChild(a)}();var instructionsButton=document.querySelector(".instructions-button");instructionsButton.addEventListener("click",function(e){e.stopPropagation(),instructionsList.classList.add("is-open"),levelList.classList.remove("is-open")});for(var closeButton=document.querySelectorAll(".close-button"),i=0;i<closeButton.length;i++)closeButton[i].addEventListener("click",function(){this.parentElement.classList.remove("is-open")});document.addEventListener("click",function(){instructionsList.classList.contains("is-open")?instructionsList.classList.remove("is-open"):levelList.classList.contains("is-open")&&levelList.classList.remove("is-open")});var levelSelectButton=document.querySelector(".level-select-button"),nextLevelButton=document.querySelector(".next-level-button");if(levelSelectButton.addEventListener("click",function(e){e.stopPropagation(),levelList.classList.add("is-open"),instructionsList.classList.remove("is-open")}),nextLevelButton.style.top=canvas.offsetTop+"px",levelList.addEventListener("click",function(e){var t=getParent(e.target,".level-list__item");if(t){var n=t.getAttribute("data-id");loadLevel(n)}}),"object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(e){Storage.prototype._setItem=Storage.prototype.setItem,Storage.prototype.setItem=function(){},alert('Your web browser does not support storing settings locally. In Safari, the most common cause of this is using "Private Browsing Mode". Some settings may not save or some features may not work properly for you.')}var initialLevel=localStorage.getItem("currentLevel")||levels[0];loadLevel(initialLevel),unipointer.bindStartEvent(canvas),window.addEventListener("mousemove",onHoverMousemove),animate();var canvasLeft=canvas.offsetLeft,canvasTop=canvas.offsetTop,pointerBehavior,cubDrag={},mazeRotate={};unipointer.pointerDown=function(e,t){e.preventDefault();var n=getIsInsideCub(t);pointerBehavior=n?cubDrag:mazeRotate,pointerBehavior.pointerDown(e,t),this._bindPostStartEvents(e)},unipointer.pointerMove=function(e,t){pointerBehavior.pointerMove(e,t)},unipointer.pointerUp=function(e,t){pointerBehavior.pointerUp(e,t),this._unbindPostStartEvents()};var dragStartPosition,dragStartPegPosition,rotatePointer;cubDrag.pointerDown=function(e,t){var n=getCubConnections();n&&n.length&&(isCubDragging=!0,dragStartPosition={x:t.pageX,y:t.pageY},dragStartPegPosition={x:cub[maze.orientation].x*gridSize+mazeCenter.x,y:cub[maze.orientation].y*gridSize+mazeCenter.y},docElem.classList.add("is-cub-dragging"))},cubDrag.pointerMove=function(e,t){isCubDragging&&(cubDragMove={x:t.pageX-dragStartPosition.x,y:t.pageY-dragStartPosition.y})},cubDrag.pointerUp=function(){cubDragMove=null,docElem.classList.remove("is-cub-dragging"),isCubDragging=!1,cub.setOffset({x:0,y:0},maze.orientation),cub.peg.x==maze.goalPosition.x&&cub.peg.y==maze.goalPosition.y&&(completeLevel(),console.log("win"))};var dragStartAngle,dragStartMazeAngle,moveAngle,mazeRotate={};mazeRotate.pointerDown=function(e,t){dragStartAngle=moveAngle=getDragAngle(t),dragStartMazeAngle=maze.flyWheel.angle,dragAngle=dragStartMazeAngle,rotatePointer=t},mazeRotate.pointerMove=function(e,t){rotatePointer=t,moveAngle=getDragAngle(t);var n=moveAngle-dragStartAngle;dragAngle=normalizeAngle(dragStartMazeAngle+n)},mazeRotate.pointerUp=function(){dragAngle=null,rotatePointer=null};var completedLevels=localStorage.getItem("completedLevels");completedLevels=completedLevels?completedLevels.split(","):[],completedLevels.forEach(function(e){var t=levelList.querySelector('[data-id="'+e+'"]');t&&t.classList.add("did-complete")}),nextLevelButton.addEventListener("click",function(){var e=getNextLevel();e&&loadLevel(e)}),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.ShareButton=e()}}(function(){return function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n?n:e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){e("../../modules/es6.array.iterator"),t.exports=e("../../modules/$.core").Array.values},{"../../modules/$.core":6,"../../modules/es6.array.iterator":34}],2:[function(e,t,n){e("../../modules/es6.math.trunc"),t.exports=e("../../modules/$.core").Math.trunc},{"../../modules/$.core":6,"../../modules/es6.math.trunc":35}],3:[function(e,t,n){e("../../modules/es6.symbol"),t.exports=e("../../modules/$.core").Symbol},{"../../modules/$.core":6,"../../modules/es6.symbol":36}],4:[function(e,t,n){var i=e("./$.is-object");t.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},{"./$.is-object":17}],5:[function(e,t,n){var i={}.toString;t.exports=function(e){return i.call(e).slice(8,-1)}},{}],6:[function(e,t,n){var i=t.exports={version:"1.2.3"};"number"==typeof __e&&(__e=i)},{}],7:[function(e,t,n){var i=e("./$.global"),o=e("./$.core"),r=e("./$.hide"),a=e("./$.redef"),s="prototype",c=function(e,t){return function(){return e.apply(t,arguments)}},l=function(e,t,n){var u,f,h,d,p=e&l.G,g=e&l.P,v=p?i:e&l.S?i[t]||(i[t]={}):(i[t]||{})[s],m=p?o:o[t]||(o[t]={});p&&(n=t);for(u in n)f=!(e&l.F)&&v&&u in v,h=(f?v:n)[u],d=e&l.B&&f?c(h,i):g&&"function"==typeof h?c(Function.call,h):h,v&&!f&&a(v,u,h),m[u]!=h&&r(m,u,d),g&&((m[s]||(m[s]={}))[u]=h)};i.core=o,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,t.exports=l},{"./$.core":6,"./$.global":12,"./$.hide":14,"./$.redef":26}],8:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],9:[function(e,t,n){var i=e("./$");t.exports=function(e){var t=i.getKeys(e),n=i.getSymbols;if(n)for(var o,r=n(e),a=i.isEnum,s=0;r.length>s;)a.call(e,o=r[s++])&&t.push(o);return t}},{"./$":22}],10:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],11:[function(e,t,n){var i={}.toString,o=e("./$.to-iobject"),r=e("./$").getNames,a="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return r(e)}catch(t){return a.slice()}};t.exports.get=function(e){return a&&"[object Window]"==i.call(e)?s(e):r(o(e))}},{"./$":22,"./$.to-iobject":30}],12:[function(e,t,n){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},{}],13:[function(e,t,n){var i={}.hasOwnProperty;t.exports=function(e,t){return i.call(e,t)}},{}],14:[function(e,t,n){var i=e("./$"),o=e("./$.property-desc");t.exports=e("./$.support-desc")?function(e,t,n){return i.setDesc(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},{"./$":22,"./$.property-desc":25,"./$.support-desc":28}],15:[function(e,t,n){var i=e("./$.cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},{"./$.cof":5}],16:[function(e,t,n){var i=e("./$.cof");t.exports=Array.isArray||function(e){return"Array"==i(e)}},{"./$.cof":5}],17:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],18:[function(e,t,n){"use strict";var i=e("./$"),o={};e("./$.hide")(o,e("./$.wks")("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=i.create(o,{next:e("./$.property-desc")(1,r)}),e("./$.tag")(t,n+" Iterator")}},{"./$":22,"./$.hide":14,"./$.property-desc":25,"./$.tag":29,"./$.wks":33}],19:[function(e,t,n){"use strict";var i=e("./$.library"),o=e("./$.def"),r=e("./$.redef"),a=e("./$.hide"),s=e("./$.has"),c=e("./$.wks")("iterator"),l=e("./$.iterators"),u=!([].keys&&"next"in[].keys()),f="@@iterator",h="keys",d="values",p=function(){return this};t.exports=function(t,n,g,v,m,y,b){e("./$.iter-create")(g,n,v);var w,S,x=function(e){switch(e){case h:return function(){return new g(this,e)};case d:return function(){return new g(this,e)}}return function(){return new g(this,e)}},k=n+" Iterator",_=t.prototype,P=_[c]||_[f]||m&&_[m],$=P||x(m);if(P){var L=e("./$").getProto($.call(new t));e("./$.tag")(L,k,!0),!i&&s(_,f)&&a(L,c,p)}if(i&&!b||a(_,c,$),l[n]=$,l[k]=p,m)if(w={values:m==d?$:x(d),keys:y?$:x(h),entries:m!=d?$:x("entries")},b)for(S in w)S in _||r(_,S,w[S]);else o(o.P+o.F*u,n,w)}},{"./$":22,"./$.def":7,"./$.has":13,"./$.hide":14,"./$.iter-create":18,"./$.iterators":21,"./$.library":24,"./$.redef":26,"./$.tag":29,"./$.wks":33}],20:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],21:[function(e,t,n){t.exports={}},{}],22:[function(e,t,n){var i=Object;t.exports={create:i.create,getProto:i.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:i.getOwnPropertyDescriptor,setDesc:i.defineProperty,setDescs:i.defineProperties,getKeys:i.keys,getNames:i.getOwnPropertyNames,getSymbols:i.getOwnPropertySymbols,each:[].forEach}},{}],23:[function(e,t,n){var i=e("./$"),o=e("./$.to-iobject");t.exports=function(e,t){for(var n,r=o(e),a=i.getKeys(r),s=a.length,c=0;s>c;)if(r[n=a[c++]]===t)return n}},{"./$":22,"./$.to-iobject":30}],24:[function(e,t,n){t.exports=!1},{}],25:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],26:[function(e,t,n){var i=e("./$.global"),o=e("./$.hide"),r=e("./$.uid")("src"),a="toString",s=Function[a],c=(""+s).split(a);e("./$.core").inspectSource=function(e){return s.call(e)},(t.exports=function(e,t,n,a){"function"==typeof n&&(n.hasOwnProperty(r)||o(n,r,e[t]?""+e[t]:c.join(String(t))),n.hasOwnProperty("name")||o(n,"name",t)),e===i?e[t]=n:(a||delete e[t],o(e,t,n))})(Function.prototype,a,function(){return"function"==typeof this&&this[r]||s.call(this)})},{"./$.core":6,"./$.global":12,"./$.hide":14,"./$.uid":31}],27:[function(e,t,n){var i=e("./$.global"),o="__core-js_shared__",r=i[o]||(i[o]={});t.exports=function(e){return r[e]||(r[e]={})}},{"./$.global":12}],28:[function(e,t,n){t.exports=!e("./$.fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./$.fails":10}],29:[function(e,t,n){var i=e("./$").setDesc,o=e("./$.has"),r=e("./$.wks")("toStringTag");t.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,r)&&i(e,r,{configurable:!0,value:t})}},{"./$":22,"./$.has":13,"./$.wks":33}],30:[function(e,t,n){var i=e("./$.iobject"),o=e("./$.defined");t.exports=function(e){return i(o(e))}},{"./$.defined":8,"./$.iobject":15}],31:[function(e,t,n){var i=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+o).toString(36))}},{}],32:[function(e,t,n){var i=e("./$.wks")("unscopables");void 0==[][i]&&e("./$.hide")(Array.prototype,i,{}),t.exports=function(e){[][i][e]=!0}},{"./$.hide":14,"./$.wks":33}],33:[function(e,t,n){var i=e("./$.shared")("wks"),o=e("./$.global").Symbol;
t.exports=function(t){return i[t]||(i[t]=o&&o[t]||(o||e("./$.uid"))("Symbol."+t))}},{"./$.global":12,"./$.shared":27,"./$.uid":31}],34:[function(e,t,n){"use strict";var i=e("./$.unscope"),o=e("./$.iter-step"),r=e("./$.iterators"),a=e("./$.to-iobject");e("./$.iter-define")(Array,"Array",function(e,t){this._t=a(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,n):"values"==t?o(0,e[n]):o(0,[n,e[n]])},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},{"./$.iter-define":19,"./$.iter-step":20,"./$.iterators":21,"./$.to-iobject":30,"./$.unscope":32}],35:[function(e,t,n){var i=e("./$.def");i(i.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},{"./$.def":7}],36:[function(e,t,n){"use strict";var i=e("./$"),o=e("./$.global"),r=e("./$.has"),a=e("./$.support-desc"),s=e("./$.def"),c=e("./$.redef"),l=e("./$.fails"),u=e("./$.shared"),f=e("./$.tag"),h=e("./$.uid"),d=e("./$.wks"),p=e("./$.keyof"),g=e("./$.get-names"),v=e("./$.enum-keys"),m=e("./$.is-array"),y=e("./$.an-object"),b=e("./$.to-iobject"),w=e("./$.property-desc"),S=i.getDesc,x=i.setDesc,k=i.create,_=g.get,P=o.Symbol,$=o.JSON,L=$&&$.stringify,C=!1,z=d("_hidden"),A=i.isEnum,E=u("symbol-registry"),M=u("symbols"),T="function"==typeof P,I=Object.prototype,j=a&&l(function(){return 7!=k(x({},"a",{get:function(){return x(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=S(I,t);i&&delete I[t],x(e,t,n),i&&e!==I&&x(I,t,i)}:x,D=function(e){var t=M[e]=k(P.prototype);return t._k=e,a&&C&&j(I,e,{configurable:!0,set:function(t){r(this,z)&&r(this[z],e)&&(this[z][e]=!1),j(this,e,w(1,t))}}),t},O=function(e){return"symbol"==typeof e},F=function(e,t,n){return n&&r(M,t)?(n.enumerable?(r(e,z)&&e[z][t]&&(e[z][t]=!1),n=k(n,{enumerable:w(0,!1)})):(r(e,z)||x(e,z,w(1,{})),e[z][t]=!0),j(e,t,n)):x(e,t,n)},U=function(e,t){y(e);for(var n,i=v(t=b(t)),o=0,r=i.length;r>o;)F(e,n=i[o++],t[n]);return e},W=function(e,t){return void 0===t?k(e):U(k(e),t)},B=function(e){var t=A.call(this,e);return t||!r(this,e)||!r(M,e)||r(this,z)&&this[z][e]?t:!0},H=function(e,t){var n=S(e=b(e),t);return!n||!r(M,t)||r(e,z)&&e[z][t]||(n.enumerable=!0),n},N=function(e){for(var t,n=_(b(e)),i=[],o=0;n.length>o;)r(M,t=n[o++])||t==z||i.push(t);return i},R=function(e){for(var t,n=_(b(e)),i=[],o=0;n.length>o;)r(M,t=n[o++])&&i.push(M[t]);return i},q=function(e){for(var t,n,i=[e],o=1,r=arguments;r.length>o;)i.push(r[o++]);return t=i[1],"function"==typeof t&&(n=t),!n&&m(t)||(t=function(e,t){return n&&(t=n.call(this,e,t)),O(t)?void 0:t}),i[1]=t,L.apply($,i)},V=l(function(){var e=P();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))});T||(P=function(){if(O(this))throw TypeError("Symbol is not a constructor");return D(h(arguments.length>0?arguments[0]:void 0))},c(P.prototype,"toString",function(){return this._k}),O=function(e){return e instanceof P},i.create=W,i.isEnum=B,i.getDesc=H,i.setDesc=F,i.setDescs=U,i.getNames=g.get=N,i.getSymbols=R,a&&!e("./$.library")&&c(I,"propertyIsEnumerable",B,!0));var J={"for":function(e){return r(E,e+="")?E[e]:E[e]=P(e)},keyFor:function(e){return p(E,e)},useSetter:function(){C=!0},useSimple:function(){C=!1}};i.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(e){var t=d(e);J[e]=T?t:D(t)}),C=!0,s(s.G+s.W,{Symbol:P}),s(s.S,"Symbol",J),s(s.S+s.F*!T,"Object",{create:W,defineProperty:F,defineProperties:U,getOwnPropertyDescriptor:H,getOwnPropertyNames:N,getOwnPropertySymbols:R}),$&&s(s.S+s.F*(!T||V),"JSON",{stringify:q}),f(P,"Symbol"),f(Math,"Math",!0),f(o.JSON,"JSON",!0)},{"./$":22,"./$.an-object":4,"./$.def":7,"./$.enum-keys":9,"./$.fails":10,"./$.get-names":11,"./$.global":12,"./$.has":13,"./$.is-array":16,"./$.keyof":23,"./$.library":24,"./$.property-desc":25,"./$.redef":26,"./$.shared":27,"./$.support-desc":28,"./$.tag":29,"./$.to-iobject":30,"./$.uid":31,"./$.wks":33}],37:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e,t,n){for(var i=!0;i;){var o=e,r=t,a=n;i=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,r);if(void 0!==s){if("value"in s)return s.value;var c=s.get;if(void 0===c)return;return c.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=r,n=a,i=!0,s=l=void 0}},c=e("./share-utils"),l=i(c);e("core-js/fn/symbol"),e("core-js/fn/array/iterator"),e("core-js/fn/math/trunc");var u=function(e){function t(e,n){o(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),"object"==typeof e?(this.element=void 0,n=e):this.element=e,this.el={head:document.getElementsByTagName("head")[0],body:document.getElementsByTagName("body")[0]},this.config={enabledNetworks:0,protocol:"//",url:window.location.href,caption:null,title:this._defaultTitle(),image:this._defaultImage(),description:this._defaultDescription(),ui:{flyout:"sb-top sb-center",buttonText:"Share",namespace:"sb-",networkOrder:[],collision:!1},networks:{googlePlus:{enabled:!0,url:null},twitter:{enabled:!0,url:null,description:null},facebook:{enabled:!0,loadSdk:!0,url:null,appId:null,title:null,caption:null,description:null,image:null},pinterest:{enabled:!0,url:null,image:null,description:null},reddit:{enabled:!0,url:null,title:null},linkedin:{enabled:!0,url:null,title:null,description:null},whatsapp:{enabled:!0,description:null,url:null},email:{enabled:!0,title:null,description:null}}},this.listener=null,this._setup(this.element,n)}return r(t,e),a(t,[{key:"open",value:function(){this._public("Open")}},{key:"close",value:function(){this._public("Close")}},{key:"toggle",value:function(){this._public("Toggle")}},{key:"toggleListen",value:function(){this._public("Listen")}},{key:"_public",value:function(e){var n=void 0;n="undefined"==typeof element?s(Object.getPrototypeOf(t.prototype),"_objToArray",this).call(this,document.getElementsByTagName("share-button")):document.querySelectorAll(element);var i=!0,o=!1,r=void 0;try{for(var a,c=n[Symbol.iterator]();!(i=(a=c.next()).done);i=!0){var l=a.value,u=l.getElementsByClassName(this.config.ui.namespace+"social")[0];this["_event"+e](l,u)}}catch(f){o=!0,r=f}finally{try{!i&&c["return"]&&c["return"]()}finally{if(o)throw r}}}},{key:"_setup",value:function(e,n){var i=void 0;"undefined"==typeof e?i=s(Object.getPrototypeOf(t.prototype),"_objToArray",this).call(this,document.getElementsByTagName("share-button")):(i=document.querySelectorAll("share-button"+e),"object"==typeof i&&(i=s(Object.getPrototypeOf(t.prototype),"_objToArray",this).call(this,i))),this._merge(this.config,n),this.config.networks.whatsapp.enabled&&!this._isMobile()&&(this.config.networks.whatsapp.enabled=!1),0===this.config.ui.networkOrder.length&&(this.config.ui.networkOrder=["pinterest","twitter","facebook","whatsapp","googlePlus","reddit","linkedin","email"]);var o=!0,r=!1,a=void 0;try{for(var c,l=Object.keys(this.config.networks)[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var u=c.value;this.config.ui.networkOrder.indexOf(u.toString())<0&&(this.config.networks[u].enabled=!1,this.config.ui.networkOrder.push(u))}}catch(f){r=!0,a=f}finally{try{!o&&l["return"]&&l["return"]()}finally{if(r)throw a}}this._fixFlyout(),this._detectNetworks(),this._normalizeNetworkConfiguration(),this.config.networks.facebook.enabled&&this.config.networks.facebook.loadSdk&&this._injectFacebookSdk();var h=0,d=!0,p=!1,g=void 0;try{for(var v,m=i[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var y=v.value;this._setupInstance(y,h++)}}catch(f){p=!0,g=f}finally{try{!d&&m["return"]&&m["return"]()}finally{if(p)throw g}}}},{key:"_setupInstance",value:function(e,t){var n=this;this._hide(e),this._addClass(e,"sharer-"+t),this._injectHtml(e),this._show(e);var i=e.getElementsByClassName(this.config.ui.namespace+"social")[0],o=e.getElementsByTagName("li");this._addClass(i,"networks-"+this.config.enabledNetworks),e.addEventListener("click",function(){return n._eventToggle(e,i)});var r=function(t){var i=o[t];"undefined"!=typeof i&&!function(){var t=i.getAttribute("data-network"),o=i.getElementsByTagName("a")[0];n._addClass(i,n.config.networks[t]["class"]),"email"!==i.className&&o.setAttribute("onclick","return false"),o.addEventListener("mousedown",function(){n._hook("before",t,e)}),o.addEventListener("mouseup",function(){n["_network"+t.capFLetter()](i)}),o.addEventListener("click",function(){n._hook("after",t,e)})}()};for(var a in Object.keys(o))r(a)}},{key:"_eventToggle",value:function(e,t){this._hasClass(t,"active")?this._eventClose(t):this._eventOpen(e,t)}},{key:"_eventOpen",value:function(e,t){this._hasClass(t,"load")&&this._removeClass(t,"load"),this.collision&&this._collisionDetection(e,t),this._addClass(t,"active")}},{key:"_eventClose",value:function(e){this._removeClass(e,"active")}},{key:"_eventListen",value:function(e,t){var n=this,i=this._getDimensions(e,t);null===this.listener?this.listener=window.setInterval(function(){return n._adjustClasses(e,t,i)},100):(window.clearInterval(this.listener),this.listener=null)}},{key:"_fixFlyout",value:function(){var e=this.config.ui.flyout.split(" ");e[0].substring(0,this.config.ui.namespace.length)!==this.config.ui.namespace&&(e[0]=""+this.config.ui.namespace+e[0]),e[1].substring(0,this.config.ui.namespace.length)!==this.config.ui.namespace&&(e[1]=""+this.config.ui.namespace+e[1]),this.config.ui.flyout=e.join(" ")}},{key:"_collisionDetection",value:function(e,t){var n=this,i=this._getDimensions(e,t);this._adjustClasses(e,t,i),e.classList.contains("clicked")||(window.addEventListener("scroll",function(){return n._adjustClasses(e,i)}),window.addEventListener("resize",function(){return n._adjustClasses(e,i)}),e.classList.add("clicked"))}},{key:"_getDimensions",value:function(e,t){return{networksWidth:t.offsetWidth,buttonHeight:e.offsetHeight,buttonWidth:e.offsetWidth}}},{key:"_adjustClasses",value:function(e,t,n){var i=window.innerWidth,o=window.innerHeight,r=e.getBoundingClientRect().left+n.buttonWidth/2,a=i-r,s=e.getBoundingClientRect().top+n.buttonHeight/2,c=this._findLocation(r,s,i,o);if("middle"===c[1]&&"center"!==c[0]&&("left"===c[0]&&i<=r+220+n.buttonWidth/2||"right"===c[0]&&i<=a+220+n.buttonWidth/2))t.classList.add(this.config.ui.namespace+"top"),t.classList.remove(this.config.ui.namespace+"middle"),t.classList.remove(this.config.ui.namespace+"bottom");else{switch(c[0]){case"left":t.classList.add(this.config.ui.namespace+"right"),t.classList.remove(this.config.ui.namespace+"center"),t.classList.remove(this.config.ui.namespace+"left");break;case"center":"top"!==c[1]&&t.classList.add(this.config.ui.namespace+"top"),t.classList.add(this.config.ui.namespace+"center"),t.classList.remove(this.config.ui.namespace+"left"),t.classList.remove(this.config.ui.namespace+"right"),t.classList.remove(this.config.ui.namespace+"middle");break;case"right":t.classList.add(this.config.ui.namespace+"left"),t.classList.remove(this.config.ui.namespace+"center"),t.classList.remove(this.config.ui.namespace+"right")}switch(c[1]){case"top":t.classList.add(this.config.ui.namespace+"bottom"),t.classList.remove(this.config.ui.namespace+"middle"),"center"!==c[0]&&t.classList.remove(this.config.ui.namespace+"top");break;case"middle":"center"!==c[0]&&(t.classList.add(this.config.ui.namespace+"middle"),t.classList.remove(this.config.ui.namespace+"top")),t.classList.remove(this.config.ui.namespace+"bottom");break;case"bottom":t.classList.add(this.config.ui.namespace+"top"),t.classList.remove(this.config.ui.namespace+"middle"),t.classList.remove(this.config.ui.namespace+"bottom")}}}},{key:"_findLocation",value:function(e,t,n,i){var o=["left","center","right"],r=["top","middle","bottom"],a=Math.trunc(3*(1-(n-e)/n)),s=Math.trunc(3*(1-(i-t)/i));return a>=3?a=2:-1>=a&&(a=0),s>=3?s=2:-1>=s&&(s=0),[o[a],r[s]]}},{key:"_networkFacebook",value:function(e){return this.config.networks.facebook.loadSdk?window.FB?(this._updateHref(e,"https://www.facebook.com/sharer/sharer.php",{u:this.config.networks.facebook.url}),FB.ui({method:"feed",name:this.config.networks.facebook.title,link:this.config.networks.facebook.url,picture:this.config.networks.facebook.image,caption:this.config.networks.facebook.caption,description:this.config.networks.facebook.description})):console.error("The Facebook JS SDK hasn't loaded yet."):this._updateHref(e,"https://www.facebook.com/sharer/sharer.php",{u:this.config.networks.facebook.url})}},{key:"_networkTwitter",value:function(e){this._updateHref(e,"https://twitter.com/intent/tweet",{text:this.config.networks.twitter.description,url:this.config.networks.twitter.url})}},{key:"_networkGooglePlus",value:function(e){this._updateHref(e,"https://plus.google.com/share",{url:this.config.networks.googlePlus.url})}},{key:"_networkPinterest",value:function(e){this._updateHref(e,"https://www.pinterest.com/pin/create/button",{url:this.config.networks.pinterest.url,media:this.config.networks.pinterest.image,description:this.config.networks.pinterest.description})}},{key:"_networkLinkedin",value:function(e){this._updateHref(e,"https://www.linkedin.com/shareArticle",{mini:"true",url:this.config.networks.linkedin.url,title:this.config.networks.linkedin.title,summary:this.config.networks.linkedin.description})}},{key:"_networkEmail",value:function(e){this._updateHref(e,"mailto:",{subject:this.config.networks.email.title,body:this.config.networks.email.description})}},{key:"_networkReddit",value:function(e){this._updateHref(e,"http://www.reddit.com/submit",{url:this.config.networks.reddit.url,title:this.config.networks.reddit.title})}},{key:"_networkWhatsapp",value:function(e){this._updateHref(e,"whatsapp://send",{text:this.config.networks.whatsapp.description+" "+this.config.networks.whatsapp.url})}},{key:"_injectStylesheet",value:function(e){if(!this.el.head.querySelector("link[href='"+e+"']")){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href",e),this.el.head.appendChild(t)}}},{key:"_injectHtml",value:function(e){var t=this.config.ui.networkOrder,n="",i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;n+="<li class='"+c+"' data-network='"+c+"'><a></a></li>"}}catch(l){o=!0,r=l}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw r}}e.innerHTML=this.config.ui.buttonText+"<div class='"+this.config.ui.namespace+"social load "+this.config.ui.flyout+"'><ul>"+n+"</ul></div>"}},{key:"_injectFacebookSdk",value:function(){if(!window.FB&&this.config.networks.facebook.appId&&!this.el.body.querySelector("#fb-root")){var e=document.createElement("script");e.text="window.fbAsyncInit=function(){FB.init({appId:'"+this.config.networks.facebook.appId+"',status:true,xfbml:true})};(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if (e.getElementById(n)){return}r=e.createElement(t);r.id=n;r.src='//connect.facebook.net/en_US/all.js';i.parentNode.insertBefore(r,i)})(document,'script','facebook-jssdk');";var t=document.createElement("div");t.id="fb-root",this.el.body.appendChild(t),this.el.body.appendChild(e)}}},{key:"_hook",value:function(e,t,n){var i=this.config.networks[t][e];if("function"==typeof i){var o=i.call(this.config.networks[t],n);void 0!==o&&(o=this._normalizeFilterConfigUpdates(o),this.extend(this.config.networks[t],o,!0),this._normalizeNetworkConfiguration())}}},{key:"_defaultTitle",value:function(){var e=void 0;return(e=document.querySelector('meta[property="og:title"]')||document.querySelector('meta[name="twitter:title"]'))?e.getAttribute("content"):(e=document.querySelector("title"))?e.textContent||e.innerText:void 0}},{key:"_defaultImage",value:function(){var e=void 0;return(e=document.querySelector('meta[property="og:image"]')||document.querySelector('meta[name="twitter:image"]'))?e.getAttribute("content"):void 0}},{key:"_defaultDescription",value:function(){var e=void 0;return(e=document.querySelector('meta[property="og:description"]')||document.querySelector('meta[name="twitter:description"]')||document.querySelector('meta[name="description"]'))?e.getAttribute("content"):""}},{key:"_detectNetworks",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,o=Object.keys(this.config.networks)[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value,a=!0,s=!1,c=void 0;try{for(var l,u=Object.keys(this.config.networks[r])[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var f=l.value;null===this.config.networks[r][f]&&(this.config.networks[r][f]=this.config[f])}}catch(h){s=!0,c=h}finally{try{!a&&u["return"]&&u["return"]()}finally{if(s)throw c}}this.config.networks[r].enabled?(this["class"]="enabled",this.config.enabledNetworks+=1):this["class"]="disabled",this.config.networks[r]["class"]=this["class"]}}catch(h){t=!0,n=h}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}}},{key:"_normalizeNetworkConfiguration",value:function(){this.config.networks.facebook.appId||(this.config.networks.facebook.loadSdk=!1),this.config.networks.twitter.description&&(this._isEncoded(this.config.networks.twitter.description)||(this.config.networks.twitter.description=encodeURIComponent(this.config.networks.twitter.description))),"number"==typeof this.config.networks.facebook.appId&&(this.config.networks.facebook.appId=this.config.networks.facebook.appId.toString())}},{key:"_normalizeFilterConfigUpdates",value:function(e){return this.config.networks.facebook.appId!==e.appId&&(console.warn("You are unable to change the Facebook appId after the button has been initialized. Please update your Facebook filters accordingly."),delete e.appId),this.config.networks.facebook.loadSdk!==e.loadSdk&&(console.warn("You are unable to change the Facebook loadSdk option after the button has been initialized. Please update your Facebook filters accordingly."),delete e.appId),e}}]),t}(l["default"]);t.exports=u},{"./share-utils":38,"core-js/fn/array/iterator":1,"core-js/fn/math/trunc":2,"core-js/fn/symbol":3}],38:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){i(this,e)}return o(e,[{key:"_getStyle",value:function(e,t){var n="";return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,"").getPropertyValue(t):e.currentStyle&&(t=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),n=e.currentStyle[t]),n}},{key:"_hide",value:function(e){e.style.display="none"}},{key:"_show",value:function(e){e.style.display="initial"}},{key:"_hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"_addClass",value:function(e,t){e.classList.add(t)}},{key:"_removeClass",value:function(e,t){e.classList.remove(t)}},{key:"_isEncoded",value:function(e){return e=e.toRFC3986(),decodeURIComponent(e)!==e}},{key:"_encode",value:function(e){return"undefined"==typeof e||null===e||this._isEncoded(e)?encodeURIComponent(e):e.toRFC3986()}},{key:"_getUrl",value:function(e){var t=this,n=(arguments.length<=1||void 0===arguments[1]?!1:arguments[1],arguments.length<=2||void 0===arguments[2]?{}:arguments[2]),i=function(){var e=[],i=!0,o=!1,r=void 0;try{for(var a,s=Object.keys(n)[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value,l=n[c];e.push(c+"="+t._encode(l))}}catch(u){o=!0,r=u}finally{try{!i&&s["return"]&&s["return"]()}finally{if(o)throw r}}return e.join("&")}();return i&&(i="?"+i),e+i}},{key:"_updateHref",value:function(e,t,n){var i=t.indexOf("mailto:")>=0,o=e.getElementsByTagName("a")[0];if(o.setAttribute("href",this._getUrl(t,!i,n)),!(i||this.config.networks.facebook.loadSdk&&"facebook"===e.getAttribute("class"))){var r={width:500,height:350};r.top=screen.height/2-r.height/2,r.left=screen.width/2-r.width/2,window.open(o.href,"targetWindow","\n          toolbar=no,\n          location=no,\n          status=no,\n          menubar=no,\n          scrollbars=yes,\n          resizable=yes,\n          left="+r.left+",\n          top="+r.top+",\n          width="+r.width+",\n          height="+r.height+"\n        ")}}},{key:"popup",value:function t(e){var n=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],t={width:500,height:350};t.top=screen.height/2-t.height/2,t.left=screen.width/2-t.width/2;var o=function(){var e=[],t=!0,o=!1,r=void 0;try{for(var a,s=Object.keys(i)[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var c=a.value,l=i[c];e.push(c+"="+n._encode(l))}}catch(u){o=!0,r=u}finally{try{!t&&s["return"]&&s["return"]()}finally{if(o)throw r}}return e.join("&")}();o&&(o="?"+o),window.open(e+o,"targetWindow","\n        toolbar=no,\n        location=no,\n        status=no,\n        menubar=no,\n        scrollbars=yes,\n        resizable=yes,\n        left="+t.left+",\n        top="+t.top+",\n        width="+t.width+",\n        height="+t.height+"\n      ")}},{key:"_merge",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){"object"!=typeof e&&(e={});for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if("object"==typeof i){e[n]=this._merge(e[n],i);continue}e[n]=i}for(var o=2,r=arguments.length;r>o;o++)_merge(e,arguments[o]);return e})},{key:"_objToArray",value:function(e){var t=[];for(var n in e)"object"==typeof e[n]&&t.push(e[n]);return t}},{key:"_isMobile",value:function(){return!(!navigator.userAgent.match(/Android|iPhone|PhantomJS/i)||navigator.userAgent.match(/iPod|iPad/i))}}]),e}();String.prototype.toRFC3986=function(){var e=encodeURIComponent(this);e.replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})},String.prototype.capFLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},n["default"]=r,t.exports=n["default"]},{}]},{},[37])(37)});